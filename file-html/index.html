<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Синхронізований Метроном</title>
  <script src="./node.js"></script>
</head>
<body>
  <h1>Синхронізований Метроном</h1>
  <p>Темп: <span id="bpm-display">60</span> BPM</p>
  <input type="range" id="bpm-slider" min="40" max="200" value="60">
  <button id="start-button">Запустити метроном</button>
  <button id="stop-button">Зупинити метроном</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const bpmDisplay = document.getElementById('bpm-display');
    const bpmSlider = document.getElementById('bpm-slider');
    const startButton = document.getElementById('start-button');
    const stopButton = document.getElementById('stop-button');

    let bpm = 60;
    let intervalId;

    // Отримуємо оновлений темп від сервера
    socket.on('setBpm', (newBpm) => {
      bpm = newBpm;
      bpmDisplay.textContent = bpm;
      bpmSlider.value = bpm;

      if (intervalId) {
        clearInterval(intervalId);
        startMetronome();
      }
    });

    // Відправка нового темпу на сервер
    bpmSlider.addEventListener('input', () => {
      bpm = bpmSlider.value;
      bpmDisplay.textContent = bpm;
      socket.emit('changeBpm', bpm);
    });

    // Функція запуску метронома
    function startMetronome() {
      const interval = 60000 / bpm; // Інтервал в мс між ударами
      intervalId = setInterval(() => {
        console.log('Тик'); // Це може бути аудіосигнал
      }, interval);
    }

    // Кнопка для старту метронома
    startButton.addEventListener('click', () => {
      if (!intervalId) {
        startMetronome();
      }
    });

    // Кнопка для зупинки метронома
    stopButton.addEventListener('click', () => {
      clearInterval(intervalId);
      intervalId = null;
    });
  </script>
</body>
</html>